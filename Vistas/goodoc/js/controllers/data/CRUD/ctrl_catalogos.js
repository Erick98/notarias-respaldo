function ctrl_catalogos($scope,conexion,catalogos,$rootScope){catalogos.get_catalogos($scope);$scope.varGrupoList=new Array();$scope.refreshListVars=function(){catalogos.get_lista_variables($scope);}
$scope.refreshListGpo=function(){catalogos.get_lista_grupos($scope);}
$scope.gpo_guardar=function(){if($scope.myForm.$valid){conexion.gpo_agregar({"usuario":$scope.usr_global,"grupo":$scope.grupo},function(data){if(data.exito){ejecutaAlerta(1,"Se registro correctamente el grupo");setTimeout(function(){document.getElementById("myForm").reset();},1000);$("#btn_actualizar").fadeOut("slow");$("#btn_actualizar").parent().append("<span> </span>")
$scope.refreshListGpo();}else{ejecutaAlerta(2,'Ocurrió un error: '+data.estatus);}},function(error){ejecutaAlerta(2,'Ocurrió un error al guardar el grupo '+error.status);})}else{$scope.myForm.submitted=true;}}
$scope.gpo_actualizar=function(){if($scope.myForm.$valid){conexion.gpo_actualizar({"usuario":$scope.usr_global,"grupo":$scope.grupo},function(data){if(data.exito){ejecutaAlerta(1,"Se actualizó correctamente el grupo");setTimeout(function(){document.getElementById("myForm").reset();$scope.grupo=null;$("#btn_actualizar").fadeOut("slow");$("#btn_actualizar").parent().append("<span> </span>")},1000);$scope.refreshListGpo();}else{ejecutaAlerta(2,'Ocurrió un error: '+data.estatus);}},function(error){ejecutaAlerta(2,'Ocurrió un error al actualizar el grupo: '+error.status);})}else{$scope.myForm.submitted=true;}}
$scope.gpo_obtiene=function(idgpo){conexion.gpo_obtiene_x_id({"usuario":$scope.usr_global,"grupo":{"idgrupo":idgpo}},function(data){if(data.exito){$scope.grupo=data.grupo;console.info($scope.grupo);$("#btn_actualizar").parent().find("span").remove();$("#btn_actualizar").fadeIn("slow");$scope.isedit=true;}else{ejecutaAlerta(2,'Ocurrió un error: '+data.estatus);}},function(error){ejecutaAlerta(2,'Ocurrió un error al guardar el grupo: '+error.status);});}
$scope.cancel_edit=function(){$scope.grupo={};$scope.isedit=false;}
$scope.append_grupo=function(){var tmp_gpo={"variable":$scope.var_select.originalObject,"grupo":$scope.gpo_select.originalObject,"dsorden":$scope.varGrupoList.length}
console.info("antes de meter el objeto",$scope.varGrupoList);$scope.varGrupoList.push(tmp_gpo);console.info("despues de meter el objeto",$scope.varGrupoList);}
$scope.del_grupo=function(grupo){if(confirm("¿Estas seguro de borrar este grupo?")){$scope.grupo=grupo;$scope.grupo.isactivo=false;conexion.gpo_actualizar({"usuario":$scope.usr_global,"grupo":$scope.grupo},function(data){if(data.exito){ejecutaAlerta(1,"Se eliminó correctamente el grupo");setTimeout(function(){document.getElementById("myForm").reset();$scope.grupo={};},1000);$scope.refreshListGpo();}else{ejecutaAlerta(2,'Ocurrió un error: '+data.estatus);}},function(error){ejecutaAlerta(2,'Algo malo paso al actualizar el grupo: '+error.status);})}}
$scope.definir_grupo=function(grupo){$rootScope.def_gpo=grupo;$scope.goTo('/catalogo_grupos_definicion');}
catalogos.get_tipo_dato($scope);catalogos.get_operadores($scope);$scope.refreshListGpo();$scope.refreshListVars();}