function ctrl_expedientes_compartir($scope,$rootScope,conexion_app,conexion,catalogos){catalogos.obtener_para_asignar($scope);$scope.usuarios_compartir=[];if($rootScope.exp_compartido){$scope.expediente=$rootScope.exp_compartido;console.info($scope.expediente);delete $rootScope.exp_compartido;}
function obtener_usu_asoc(){conexion_app.expediente_listar_usuarios_asociados({"usuario":$scope.usr_global,"expediente":$scope.expediente},function(data){if(data.exito){$scope.usuarios_compartir=data.usuariosList;}else{ejecutaAlerta(2,"Ocurrio un error al listar los usuarios asociados"+data.estatus);}},function(error){alert("Ocurrio un error al obtener los usuarios asociados: "+error.status);});}
$scope.agrega_usuario=function(){conexion_app.expediente_asociar_usuario({"expediente":$scope.expediente,"usuario":$scope.usr_global,"usrAsoc":$scope.usuario_select},function(data){if(data.exito){ejecutaAlerta(1,"Se guardó correctamente al usuario")
obtener_usu_asoc();}else{ejecutaAlerta(2,"Ocurrió un error al asignar el usuario al expediente: "+data.estatus);}},function(error){alert("Algo malo paso al asignar al usuario: "+error.status)});}
$scope.elimina_usuario=function(usuario){if(!confirm("¿Realmente deseas eliminar a este usuario?"))return;conexion_app.expediente_desasociar_usuario({"expediente":$scope.expediente,"usuario":$scope.usr_global,"usrAsoc":usuario},function(data){if(data.exito){ejecutaAlerta(1,"Se eliminó correctamente al usuario");obtener_usu_asoc();}else{ejecutaAlerta(2,"Ocurrió un error al eliminar el usuario al expediente: "+data.estatus);}},function(error){alert("Algo malo paso al asignar al usuario: "+error.status);});}
$scope.buscaryborra=function(quitar,poner,dato){var index=quitar.indexOf(dato);if(index>-1){quitar.splice(index,1);poner.push(dato);}}
obtener_usu_asoc();}