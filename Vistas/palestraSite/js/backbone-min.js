!function(){var t,e=this,i=e.Backbone;t="undefined"!=typeof exports?exports:e.Backbone={},t.VERSION="0.5.3";var r=e._;r||"undefined"==typeof require||(r=require("underscore")._);var n=e.jQuery||e.Zepto;t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1,t.Events={bind:function(t,e,i){var r=this._callbacks||(this._callbacks={}),n=r[t]||(r[t]=[]);return n.push([e,i]),this},unbind:function(t,e){var i;if(t){if(i=this._callbacks)if(e){var r=i[t];if(!r)return this;for(var n=0,s=r.length;s>n;n++)if(r[n]&&e===r[n][0]){r[n]=null;break}}else i[t]=[]}else this._callbacks={};return this},trigger:function(t){var e,i,r,n,s,a=2;if(!(i=this._callbacks))return this;for(;a--;)if(r=a?t:"all",e=i[r])for(var o=0,c=e.length;c>o;o++)(n=e[o])?(s=a?Array.prototype.slice.call(arguments,1):arguments,n[0].apply(n[1]||this,s)):(e.splice(o,1),o--,c--);return this}},t.Model=function(t,e){var i;t||(t={}),(i=this.defaults)&&(r.isFunction(i)&&(i=i.call(this)),t=r.extend({},i,t)),this.attributes={},this._escapedAttributes={},this.cid=r.uniqueId("c"),this.set(t,{silent:!0}),this._changed=!1,this._previousAttributes=r.clone(this.attributes),e&&e.collection&&(this.collection=e.collection),this.initialize(t,e)},r.extend(t.Model.prototype,t.Events,{_previousAttributes:null,_changed:!1,idAttribute:"id",initialize:function(){},toJSON:function(){return r.clone(this.attributes)},get:function(t){return this.attributes[t]},escape:function(t){var e;if(e=this._escapedAttributes[t])return e;var i=this.attributes[t];return this._escapedAttributes[t]=w(null==i?"":""+i)},has:function(t){return null!=this.attributes[t]},set:function(t,e){if(e||(e={}),!t)return this;t.attributes&&(t=t.attributes);var i=this.attributes,n=this._escapedAttributes;if(!e.silent&&this.validate&&!this._performValidation(t,e))return!1;this.idAttribute in t&&(this.id=t[this.idAttribute]);var s=this._changing;this._changing=!0;for(var a in t){var o=t[a];r.isEqual(i[a],o)||(i[a]=o,delete n[a],this._changed=!0,e.silent||this.trigger("change:"+a,this,o,e))}return s||e.silent||!this._changed||this.change(e),this._changing=!1,this},unset:function(t,e){if(!(t in this.attributes))return this;e||(e={}),this.attributes[t];var i={};return i[t]=void 0,e.silent||!this.validate||this._performValidation(i,e)?(delete this.attributes[t],delete this._escapedAttributes[t],t==this.idAttribute&&delete this.id,this._changed=!0,e.silent||(this.trigger("change:"+t,this,void 0,e),this.change(e)),this):!1},clear:function(t){t||(t={});var e,i=this.attributes,r={};for(e in i)r[e]=void 0;if(!t.silent&&this.validate&&!this._performValidation(r,t))return!1;if(this.attributes={},this._escapedAttributes={},this._changed=!0,!t.silent){for(e in i)this.trigger("change:"+e,this,void 0,t);this.change(t)}return this},fetch:function(e){e||(e={});var i=this,r=e.success;return e.success=function(t,n,s){return i.set(i.parse(t,s),e)?(r&&r(i,t),void 0):!1},e.error=A(e.error,i,e),(this.sync||t.sync).call(this,"read",this,e)},save:function(e,i){if(i||(i={}),e&&!this.set(e,i))return!1;var r=this,n=i.success;i.success=function(t,e,s){return r.set(r.parse(t,s),i)?(n&&n(r,t,s),void 0):!1},i.error=A(i.error,r,i);var s=this.isNew()?"create":"update";return(this.sync||t.sync).call(this,s,this,i)},destroy:function(e){if(e||(e={}),this.isNew())return this.trigger("destroy",this,this.collection,e);var i=this,r=e.success;return e.success=function(t){i.trigger("destroy",i,i.collection,e),r&&r(i,t)},e.error=A(e.error,i,e),(this.sync||t.sync).call(this,"delete",this,e)},url:function(){var t=b(this.collection)||this.urlRoot||k();return this.isNew()?t:t+("/"==t.charAt(t.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(t){return t},clone:function(){return new this.constructor(this)},isNew:function(){return null==this.id},change:function(t){this.trigger("change",this,t),this._previousAttributes=r.clone(this.attributes),this._changed=!1},hasChanged:function(t){return t?this._previousAttributes[t]!=this.attributes[t]:this._changed},changedAttributes:function(t){t||(t=this.attributes);var e=this._previousAttributes,i=!1;for(var n in t)r.isEqual(e[n],t[n])||(i=i||{},i[n]=t[n]);return i},previous:function(t){return t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return r.clone(this._previousAttributes)},_performValidation:function(t,e){var i=this.validate(t);return i?(e.error?e.error(this,i,e):this.trigger("error",this,i,e),!1):!0}}),t.Collection=function(t,e){e||(e={}),e.comparator&&(this.comparator=e.comparator),r.bindAll(this,"_onModelEvent","_removeReference"),this._reset(),t&&this.reset(t,{silent:!0}),this.initialize.apply(this,arguments)},r.extend(t.Collection.prototype,t.Events,{model:t.Model,initialize:function(){},toJSON:function(){return this.map(function(t){return t.toJSON()})},add:function(t,e){if(r.isArray(t))for(var i=0,n=t.length;n>i;i++)this._add(t[i],e);else this._add(t,e);return this},remove:function(t,e){if(r.isArray(t))for(var i=0,n=t.length;n>i;i++)this._remove(t[i],e);else this._remove(t,e);return this},get:function(t){return null==t?null:this._byId[null!=t.id?t.id:t]},getByCid:function(t){return t&&this._byCid[t.cid||t]},at:function(t){return this.models[t]},sort:function(t){if(t||(t={}),!this.comparator)throw new Error("Cannot sort a set without a comparator");return this.models=this.sortBy(this.comparator),t.silent||this.trigger("reset",this,t),this},pluck:function(t){return r.map(this.models,function(e){return e.get(t)})},reset:function(t,e){return t||(t=[]),e||(e={}),this.each(this._removeReference),this._reset(),this.add(t,{silent:!0}),e.silent||this.trigger("reset",this,e),this},fetch:function(e){e||(e={});var i=this,r=e.success;return e.success=function(t,n,s){i[e.add?"add":"reset"](i.parse(t,s),e),r&&r(i,t)},e.error=A(e.error,i,e),(this.sync||t.sync).call(this,"read",this,e)},create:function(t,e){var i=this;if(e||(e={}),t=this._prepareModel(t,e),!t)return!1;var r=e.success;return e.success=function(t,n,s){i.add(t,e),r&&r(t,n,s)},t.save(null,e),t},parse:function(t){return t},chain:function(){return r(this.models).chain()},_reset:function(){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(e,i){if(e instanceof t.Model)e.collection||(e.collection=this);else{var r=e;e=new this.model(r,{collection:this}),e.validate&&!e._performValidation(r,i)&&(e=!1)}return e},_add:function(t,e){if(e||(e={}),t=this._prepareModel(t,e),!t)return!1;var i=this.getByCid(t);if(i)throw new Error(["Can't add the same model to a set twice",i.id]);this._byId[t.id]=t,this._byCid[t.cid]=t;var r=null!=e.at?e.at:this.comparator?this.sortedIndex(t,this.comparator):this.length;return this.models.splice(r,0,t),t.bind("all",this._onModelEvent),this.length++,e.silent||t.trigger("add",t,this,e),t},_remove:function(t,e){return e||(e={}),(t=this.getByCid(t)||this.get(t))?(delete this._byId[t.id],delete this._byCid[t.cid],this.models.splice(this.indexOf(t),1),this.length--,e.silent||t.trigger("remove",t,this,e),this._removeReference(t),t):null},_removeReference:function(t){this==t.collection&&delete t.collection,t.unbind("all",this._onModelEvent)},_onModelEvent:function(t,e,i,r){("add"!=t&&"remove"!=t||i==this)&&("destroy"==t&&this._remove(e,r),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],this._byId[e.id]=e),this.trigger.apply(this,arguments))}});var s=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","rest","last","without","indexOf","lastIndexOf","isEmpty","groupBy"];r.each(s,function(e){t.Collection.prototype[e]=function(){return r[e].apply(r,[this.models].concat(r.toArray(arguments)))}}),t.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)};var a=/:([\w\d]+)/g,o=/\*([\w\d]+)/g,c=/[-[\]{}()+?.,\\^$|#\s]/g;r.extend(t.Router.prototype,t.Events,{initialize:function(){},route:function(e,i,n){t.history||(t.history=new t.History),r.isRegExp(e)||(e=this._routeToRegExp(e)),t.history.route(e,r.bind(function(t){var r=this._extractParameters(e,t);n.apply(this,r),this.trigger.apply(this,["route:"+i].concat(r))},this))},navigate:function(e,i){t.history.navigate(e,i)},_bindRoutes:function(){if(this.routes){var t=[];for(var e in this.routes)t.unshift([e,this.routes[e]]);for(var i=0,r=t.length;r>i;i++)this.route(t[i][0],t[i][1],this[t[i][1]])}},_routeToRegExp:function(t){return t=t.replace(c,"\\$&").replace(a,"([^/]*)").replace(o,"(.*?)"),new RegExp("^"+t+"$")},_extractParameters:function(t,e){return t.exec(e).slice(1)}}),t.History=function(){this.handlers=[],r.bindAll(this,"checkUrl")};var u=/^#*/,l=/msie [\w.]+/,h=!1;r.extend(t.History.prototype,{interval:50,getFragment:function(t,e){if(null==t)if(this._hasPushState||e){t=window.location.pathname;var i=window.location.search;i&&(t+=i),0==t.indexOf(this.options.root)&&(t=t.substr(this.options.root.length))}else t=window.location.hash;return decodeURIComponent(t.replace(u,""))},start:function(t){if(h)throw new Error("Backbone.history has already been started");this.options=r.extend({},{root:"/"},this.options,t),this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var e=this.getFragment(),i=document.documentMode,s=l.exec(navigator.userAgent.toLowerCase())&&(!i||7>=i);s&&(this.iframe=n('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(e)),this._hasPushState?n(window).bind("popstate",this.checkUrl):"onhashchange"in window&&!s?n(window).bind("hashchange",this.checkUrl):setInterval(this.checkUrl,this.interval),this.fragment=e,h=!0;var a=window.location,o=a.pathname==this.options.root;return!this._wantsPushState||this._hasPushState||o?(this._wantsPushState&&this._hasPushState&&o&&a.hash&&(this.fragment=a.hash.replace(u,""),window.history.replaceState({},document.title,a.protocol+"//"+a.host+this.options.root+this.fragment)),this.options.silent?void 0:this.loadUrl()):(this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0)},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t==this.fragment&&this.iframe&&(t=this.getFragment(this.iframe.location.hash)),t==this.fragment||t==decodeURIComponent(this.fragment)?!1:(this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(window.location.hash),void 0)},loadUrl:function(t){var e=this.fragment=this.getFragment(t),i=r.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0});return i},navigate:function(t,e){var i=(t||"").replace(u,"");if(this.fragment!=i&&this.fragment!=decodeURIComponent(i)){if(this._hasPushState){var r=window.location;0!=i.indexOf(this.options.root)&&(i=this.options.root+i),this.fragment=i,window.history.pushState({},document.title,r.protocol+"//"+r.host+i)}else window.location.hash=this.fragment=i,this.iframe&&i!=this.getFragment(this.iframe.location.hash)&&(this.iframe.document.open().close(),this.iframe.location.hash=i);e&&this.loadUrl(t)}}}),t.View=function(t){this.cid=r.uniqueId("view"),this._configure(t||{}),this._ensureElement(),this.delegateEvents(),this.initialize.apply(this,arguments)};var d=function(t){return n(t,this.el)},p=/^(\S+)\s*(.*)$/,f=["model","collection","el","id","attributes","className","tagName"];r.extend(t.View.prototype,t.Events,{tagName:"div",$:d,initialize:function(){},render:function(){return this},remove:function(){return n(this.el).remove(),this},make:function(t,e,i){var r=document.createElement(t);return e&&n(r).attr(e),i&&n(r).html(i),r},delegateEvents:function(t){if(t||(t=this.events)){r.isFunction(t)&&(t=t.call(this)),n(this.el).unbind(".delegateEvents"+this.cid);for(var e in t){var i=this[t[e]];if(!i)throw new Error('Event "'+t[e]+'" does not exist');var s=e.match(p),a=s[1],o=s[2];i=r.bind(i,this),a+=".delegateEvents"+this.cid,""===o?n(this.el).bind(a,i):n(this.el).delegate(o,a,i)}}},_configure:function(t){this.options&&(t=r.extend({},this.options,t));for(var e=0,i=f.length;i>e;e++){var n=f[e];t[n]&&(this[n]=t[n])}this.options=t},_ensureElement:function(){if(this.el)r.isString(this.el)&&(this.el=n(this.el).get(0));else{var t=this.attributes||{};this.id&&(t.id=this.id),this.className&&(t["class"]=this.className),this.el=this.make(this.tagName,t)}}});var g=function(t,e){var i=v(this,t,e);return i.extend=this.extend,i};t.Model.extend=t.Collection.extend=t.Router.extend=t.View.extend=g;var y={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};t.sync=function(e,i,s){var a=y[e],o=r.extend({type:a,dataType:"json"},s);return o.url||(o.url=b(i)||k()),o.data||!i||"create"!=e&&"update"!=e||(o.contentType="application/json",o.data=JSON.stringify(i.toJSON())),t.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),t.emulateHTTP&&("PUT"===a||"DELETE"===a)&&(t.emulateJSON&&(o.data._method=a),o.type="POST",o.beforeSend=function(t){t.setRequestHeader("X-HTTP-Method-Override",a)}),"GET"===o.type||t.emulateJSON||(o.processData=!1),n.ajax(o)};var m=function(){},v=function(t,e,i){var n;return n=e&&e.hasOwnProperty("constructor")?e.constructor:function(){return t.apply(this,arguments)},r.extend(n,t),m.prototype=t.prototype,n.prototype=new m,e&&r.extend(n.prototype,e),i&&r.extend(n,i),n.prototype.constructor=n,n.__super__=t.prototype,n},b=function(t){return t&&t.url?r.isFunction(t.url)?t.url():t.url:null},k=function(){throw new Error('A "url" property or function must be specified')},A=function(t,e,i){return function(r){t?t(e,r,i):e.trigger("error",e,r,i)}},w=function(t){return t.replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}}.call(this);