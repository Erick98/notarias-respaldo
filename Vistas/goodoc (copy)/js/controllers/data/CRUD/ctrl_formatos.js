function ctrl_formatos($scope,$route,$rootScope,$filter,$timeout,conexion){$scope.obtiene_formatos=function(){conexion.formatos_listar({"usuario":$scope.usr_global},function(data){if(data.exito){$scope.formatosPublicados=data.docPublicadosList;$scope.formatosNoPublicados=data.docNoPublicadosList;console.info($scope.formatos);}else{ejecutaAlerta(2,'Ocurrió un error: '+data.estatus);}},function(error){alert("ocurrio un error al obtener los formatos: "+error.status);});};$scope.obtiene_formato_x_version_y_id=function(){conexion.formatos_get_x_version_y_id({"usuario":$rootScope.usr_global,"documentoVersiones":JSON.parse($rootScope.edit_doc)},function(data){if(data.documento!=null){$scope.docRecuperado=data.documento;}else if(data.documentoVersiones!=null){$scope.docRecuperado=data.documentoVersiones;}},function(error){});};$scope.vaciar_datos_en_ckeditor=function(){$timeout(function(){console.info("DOCUMENTO A PONER",$scope.docRecuperado)
CKEDITOR.instances["plan_ck"].insertHtml($scope.docRecuperado.txplantilla);},1000);}
if($rootScope.edit_doc&&$rootScope.edit_doc!=null){$scope.obtiene_formato_x_version_y_id();}
$scope.obtiene_tipoCatalogo=function(){conexion.obtiene_catalogo({"usuario":$scope.usr_global,"elementoCatalogo":{"catalogo":{"dsnombre":"tipo_documento"}}},function(data){$scope.tipos_formato=data.catalogoList;},function(error){alert("Algo malo ocurrio al cargar los tipos de formatos: "+error.status);});}
$scope.parseaFecha=function(fecha){return parseFecha(fecha);}
$scope.obtiene_tipoCatalogo();$scope.formato_actualizar=function(publica){$scope.docRecuperado.ispublicado=publica;$scope.docRecuperado.txplantilla=CKEDITOR.instances['plan_ck'].getData();$scope.docRecuperado.identificador=null;conexion.formato_actualizar({"usuario":$scope.usr_global,"documentoVersiones":$scope.docRecuperado},function(data){if(data.exito){ejecutaAlerta(1,"Se actualizo correctamente el formato");force_redirect('index_adm.html#/formatos_explorador');}else{ejecutaAlerta(2,'Ocurrió un error: '+data.estatus);}},function(error){ejecutaAlerta(2,'Algo malo ocurrio al actualizar el formato: '+error.status);});}
$scope.formato_add=function(publica){$scope.documento.ispublicado=publica;$scope.documento.txplantilla=CKEDITOR.instances['plan_ck'].getData();conexion.formato_add({"usuario":$scope.usr_global,"documentoVersiones":$scope.documento},function(data){if(data.exito){ejecutaAlerta(1,"Se registro correctamente el formato");force_redirect('index_adm.html#/formatos_explorador');}else{ejecutaAlerta(2,'Ocurrió un error: '+data.estatus);}},function(error){ejecutaAlerta(2,'Algo malo ocurrio al guardar la operacion: '+error.status);})}
$scope.permiteEditar=false;if($rootScope.edit_doc){$scope.permiteEditar=true;$scope.obtiene_formato_x_version_y_id();creaCK('#tb_plantilla');$('.tab-container').easytabs('select','tb_plantilla');$scope.vaciar_datos_en_ckeditor();delete $rootScope.edit_doc;}
var miruta=$route.current.$$route.originalPath;if(miruta!="/formatos_agregar")
$scope.obtiene_formatos();}